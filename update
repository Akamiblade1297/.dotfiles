#!/bin/bash
. ./vars          || exit 1
. ./verify UPDATE || exit 1

printf "$info Pulling changes from github.."
git pull origin master > /dev/null 2>/dev/null || (printf "$ers$error Failed to pull changes from github\n"; exit 1)
printf "$ers$ok Changes pulled from github\n"

for i in $homes
do
    if ! $(diff -qr $HOME/$i ./home/$i); then
        printf "$info Updating $i home file.."
        rm $HOME/$i
        cp ./home/$i $HOME/
        printf "$ers$ok Updated $i home file\n"
    fi
done

for i in $cfgs
do
    if ! $(diff -qr $HOME/.config/$i ./configs/$i); then
        printf "$info Updating $i User config.."
        rm -rf $HOME/.config/$i
        cp -r ./configs/$i $HOME/.config > /dev/null
        printf "$ers$ok Updated $i User config\n"
    fi
done

for i in $cfgs_rel
do
    if ! $(diff -qr $HOME/.config/$i $dev_rel/$i); then
        printf "$info Updating $i User config.."
        rm -rf $HOME/.config/$i
        cp -r $dev_rel/$i $HOME/.config/$i > /dev/null
        printf "$ers$ok Updated $i User config\n"
    fi
done

for i in $etcs
do
    if ! $(sudo diff -qr /etc/$i ./etc/$i); then
        printf "$info Updating $i System config.."
        sudo rm -rf /etc/$i
        sudo cp -r ./etc/$i /etc/
        printf "$ers$ok Updated $i System config\n"
    fi
done

for i in $bins
do
    if ! $(sudo diff -qr /bin/$i ./bin/$i); then
        printf "$info Updating $i Executable.."
        sudo rm -rf /bin/$i
        sudo cp -r ./bin/$i /bin/ > /dev/null
        sudo chmod +x /bin/$i > /dev/null
        printf "$ers$ok Updating $i Executable\n"
    fi
done

hyprctl reload >/dev/null 2>/dev/null || printf "$warning Couldn't reload Hyprland config\n"
printf "$ok Update complete\n"
