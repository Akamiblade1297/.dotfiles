#!/bin/bash
. ./vars          || exit 1
. ./verify UPDATE || exit 1

printf "$info Pulling changes from github.."
git pull origin master > /dev/null
printf "$ers$ok Changes pulled from github\n"

if ! $(diff -qr $HOME/.zshrc $repo/.zshrc); then
    printf "$info Updating .zshrc.."
    rm $HOME/.zshrc
    cp $repo/.zshrc $HOME
    printf "$ers$ok Updated .zshrc\n"
fi

for i in $cfgs
do
    if ! $(diff -qr $HOME/.config/$i $repo/configs/$i); then
        printf "$info Updating $i User config.."
        rm -rf $HOME/.config/$i
        cp -r $repo/configs/$i $HOME/.config > /dev/null
        printf "$ers$ok Updated $i User config\n"
    fi
done

for i in $cfgs_rel
do
    if ! $(diff -qr $HOME/.config/$i $dev_rel/$i); then
        printf "$info Updating $i User config.."
        rm -rf $HOME/.config/$i
        cp -r $dev_rel/$i $HOME/.config/$i > /dev/null
        printf "$ers$ok Updated $i User config\n"
    fi
done

for i in $etcs
do
    if ! $(sudo diff -qr /etc/$i $repo/etc/$i); then
        printf "$info Updating $i System config.."
        sudo rm -rf /etc/$i
        sudo cp -r $repo/etc/$i /etc/
        printf "$ers$ok Updated $i System config\n"
    fi
done

for i in $bins
do
    if ! $(sudo diff -qr /bin/$i $repo/bin/$i); then
        printf "$info Updating $i Executable.."
        sudo rm -rf /bin/$i
        sudo cp -r $repo/bin/$i /bin/ > /dev/null
        sudo chmod +x /bin/$i > /dev/null
        printf "$ers$ok Updating $i Executable\n"
    fi
done

hyprctl reload
echo "$ok Update complete\n"
